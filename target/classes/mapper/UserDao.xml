<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.bodiary.user.dao.UserDao">
	<!-- 회원테이블의 모든 유저 리스트 가져오기 (동률) -->
	<select id="getUserList" resultType="kr.or.bodiary.user.dto.UserDto">
		select user.user_email,user_nickname,user_gender,user_reportedcount,enabled,user_grade,role_name,user_age,user_height,user_weight,user_grade
		from user 
		inner join role
		where user.user_email = role.user_email
	</select>

	<!-- 해당 유저의 권한을 수정하는 쿼리문 (동률) -->
	<update id="userRoleUpdate" parameterType="kr.or.bodiary.user.dto.UserDto">
		update role
		set role_name = #{role_name}
		where user_email = #{user_email}
	</update>
	
	<!--  해당 유저의 총 자유게시물 가져오기(동률) -->
	<select id="freeBrdCount" resultType="int">
		SELECT count(*) as totalcount		
		FROM freeboard
		WHERE user_email = #{user_email}
	</select>
	
	<!--  해당 유저의 총 루틴자랑 게시물 가져오기(동률) -->
	<select id="routineBrdCount" resultType="int">
		SELECT count(*) as totalcount		
		FROM routineboard
		WHERE user_email = #{user_email}
	</select>
	<select id="getUser" resultType="kr.or.bodiary.user.dto.UserDto">
		select *
		from User
		where user_email= #{user_email}
	</select>
	<select id="selectUserByGender" resultType="int">
		select count(user_gender)
		from User
		where user_gender = #{user_gender}
	</select>
	<select id="selectUserCount" resultType="int">
		select count(user_email)
		from User
	</select>
	<!-- 회원가입 -->
	<insert id="insertUser">
		INSERT INTO User(
			user_email, user_pwd, user_nickname, user_gender, user_age , user_height, user_weight, user_img, user_reportedcount, enabled, user_grade
			) 
		VALUES( #{user_email},#{user_pwd}, #{user_nickname} ,#{user_gender},#{user_age}, 0, 0,'user.png', 0, 1, 'regular')
	</insert>
	<!-- 비밀번호 확인  -->
	<select id="selectPwd" resultType="String">
		select user_pwd
		from User
		where user_email= #{user_email}
	</select>
	<!-- 회원비번 수정 -->
	<update id="updatePwd">
		update User
		set user_pwd = #{user_pwd}
		where user_email = #{user_email}
	</update>
	<!-- 회원닉네임 수정 -->
	<update id="updateNick">
		update User
		set user_nickname = #{user_nickname}
		where user_email = #{user_email}
	</update>
	<!-- 회원정보 수정 -->
	<update id="updateUser">
		update User
		set user_age = #{user_age}, user_height=#{user_height}, user_weight=#{user_weight}, user_img=#{user_img}
		where user_email = #{user_email}
	</update>
	<!-- 회원권한 업데이트 -->
	<update id="updateRole">
		update Role
		set role_name='ROLE_REGULAR_USER'
		where user_email = #{user_email}
	</update>
	<!-- 휴면계정 전환 -->
	<update id="updateDormantAccount">
		update User
		set enabled=0
		where user_email=#{user_email}
	</update>
	<!-- 회원 탈퇴처리 후 grade 부여 -->
	<update id="updateWithdrawalUser">
		update User
		set user_grade = 'withdrawal', user_nickname = 'N', user_gender = 'N', enabled = 0, 
			user_age = 0, user_height = 0, user_weight = 0, user_img='N', user_deletedate = now()
		where user_email= #{user_email}
	</update>
	<!-- 회원 삭제 -->
	<delete id="deleteUser">
		delete User where user_email#{user_email}
	</delete>
	
	<!-- 회원가입시 이메일 체크 -->
	<select id="emailCheck" resultType="int">
		select count(*)
		from User
		where user_email=#{user_email}
	</select>
	
	
	<!-- ///////////////////////////////차트//////////////////////////////// -->
	
	<!-- 자신의 성별, 키에 해당하는 회원 평균 몸무게 조회 -->
	<select id="getAvgWeight" resultType="Integer">
		select avg(user_weight) from user where user_height=#{param1} and user_gender=#{param2}
	</select>
	
</mapper>